## 第三阶段
库：https://github.com/huoguocat/catcat

**一些状况**由于分工问题原定写这个阶段代码的同学没有参与前面两个部分的代码编写，导致对游戏逻辑不太熟悉导致5.18那一次ddl没有赶上，且在那一天我们才发现了我们分工有问题，所以这个阶段的代码准确说是从5.20开始写的，与助教沟通后助教建议我们两个星期的时间只把较为基础的游戏部分从单机游戏改写成了联网即可，故许多上一阶段已经在单机游戏中完成的附加任务我们没有再在联网游戏中体现，希望助教考虑看看我们单机游戏已经完成的附加任务。后续我们也会试着将6.3提交版本的代码优化。且因为考虑到我们不参加比赛，于是为了保证游戏的可玩性，我们设计了human vs human和human VS AI两个功能，并没有在human vs human中接入AI。

#### 规则实现算法

**联网框架构建：** 
（以下部分由顾张彤提供）
一、大致思路
我依据文档要求，计划为服务端、客户端分别重建项目，从程序设计层面将服务端与客户端分开。我分别为服务端、客户端设计了两个mainwindow类。
我在服务端mainwindow类中设计了send_to_client、receive_from_client、remove_client、cut_time等函数以实现基本通信功能，并为日志模块创建了Logger对象、logger指针。服务端初步实现了监听、收发信息、通知对局开始、计时、转发MOVE_OP、重启、超时判断等功能，可以进行基础通信。同时，我为日志模块构建了logger类，实现了日志功能。
在客户端的mainwindow类中，我设计了receiveMessage函数，实现了CHAT_OP、READY_OP、MOVE_OP、REJECT_OP等功能。同时设计了最初的客户端图形化界面。

二、遇到的困难
在设计服务端END_OP时，由于服务端需要具有合法性判断、胜负判断的功能，需要在END_OP中用到大量前期游戏逻辑。我请教了同学，计划利用第一阶段surakarta_rule_manager和第二阶段Board.cpp的canmove函数。由于对前期代码不熟悉、理解能力、代码能力有限，我未能独自完成服务端游戏逻辑的填写。


**游戏逻辑完善：** 
基本“照搬”前一阶段的代码，不过值得注意的是在这个时候要实现客户端和服务端的分离，所以需要将canmove函数判断得到的结果改写成op形式来发送，以此传递信息于服务端和客户端。客户端可以继续实现规则判断的逻辑，如判断不出界、没有自食、没有移动空白棋子等。但此时，这些判断主要用于本地UI的即时反馈和玩家操作的提示。服务端在接收到客户端的棋子移动请求时，需要重新验证这些请求是否符合游戏规则。但是由于时间原因，我们对MOVE_OP和END_OP的填写有所简化，故无法和别的小组联机对战。
客户端仍然负责棋盘的渲染和棋子的绘制。但此时，绘制的数据应来源于与服务端同步的棋子列表，而不是仅依赖于本地的棋子存储。当服务端接收到客户端的棋子移动请求并验证通过后，需要更新全局的棋子列表，并通知所有相关客户端进行棋盘的同步更新。
  
**AI算法：** 
定义评估函数：
评估函数用于估计一个给定游戏状态的优劣。对于不同的棋类游戏，评估函数的实现可能会有所不同。它通常会考虑一些如棋子位置、控制区域、棋子的移动性等因素。
实现minimax算法：
minimax算法是一个递归算法，它试图最小化对手的最大可能得分（如果你是先手）或最大化自己的最小可能得分（如果你是后手）。
对于每个可能的走棋，递归地计算其后续状态的得分，并返回最佳得分。
在递归过程中，保存每个节点的得分和最佳走棋。
实现alpha-beta剪枝：
alpha-beta剪枝是minimax算法的一个优化，用于减少不必要的计算。
对于每个节点，维护两个值：alpha和beta。alpha表示当前玩家在当前搜索路径上的最佳可能得分（对于先手是最大值，对于后手是最小值），而beta表示对手的最佳可能得分（对于先手是最小值，对于后手是最大值）。
如果在某个节点的搜索过程中，发现当前路径的得分已经不可能比alpha大（对于先手）或比beta小（对于后手），则剪去该分支的后续搜索，因为这些分支不会对最终决策产生影响。
选择最佳走棋：
在递归搜索结束后，根据保存的最佳得分和走棋信息，选择最佳走棋。
这通常是通过回溯到根节点并沿着保存的最佳走棋路径来实现的。
另：AI部分代码有参考网上各个ab剪枝代码。

#### 分工
**代码量**  秦禛涵2023202271 完成与AI的算法及其接入，上一阶段游戏代码填入这一阶段，并实现任务：现实能走的地方，显示上一次移动的棋子。
            苏楷棋2023202240 完成将上一阶段游戏代码填入这一阶段，并实现任务：悔棋，结算面版。
            顾张彤2023202299  实现行棋记录，以及完成整体联网的OP等函数的填写以及大框架搭建。
**测试**    秦禛涵2023202271，苏楷棋2023202240，顾张彤2023202299参与了代码测试与debug。

#### 致谢
01组同学、06组同学、王燚同学。
以及项晓清同学、张昕跃同学、杨昱文同学。
感谢交流指导。

 
